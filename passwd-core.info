Package: passwd-core
Version: 20121118
Revision: 1
BuildDepends: fink (>= 0.33.0)
Source: mirror:sourceforge:fink/passwd-%v.zip
PatchFile-MD5: b0b376fe8a5b1facec5d44b013d28170
PatchScript: <<
 sed 's|@PREFIX@|%p|g' <update-passwd.in >update-passwd
 sed 's|@PREFIX@|%p|g' <get_fink_auto_uid.pl.in >get_fink_auto_uid.pl
 sed 's|@PREFIX@|%p|g' <README.in >README
<<
CompileScript <<
echo "No compiling required."
<<
InstallScript: <<
 mkdir -p %i/etc %i/sbin %i/share/%n
 install -c -m 755 update-passwd %i/sbin/
 install -c -m 755 get_fink_auto_uid.pl %i/share/%n
 install passwd.conf.in %i/etc/passwd.conf
<<
ConfFiles: %p/etc/passwd.conf
PostInstScript: <<
if [ $1 = "configure" ] ; then
	# Check for AutoUid: in fink.conf
	auid=`%p/share/%n/get_fink_auto_uid.pl --auto`
	# transfer settings appropriately
	if [ $auid -eq 1 ] ; then
		echo "Using AutoUID settings from fink.conf"
		printf "AutoUid: true\n" >> passwd.conf
		printf "AutoUidMin: %d\n" `%p/share/%n/get_fink_auto_uid.pl --min` >> passwd.conf
		printf "AutoUidMax: %d\n" `%p/share/%n/get_fink_auto_uid.pl --max` >> passwd.conf
		echo "UIDs and GIDs will be dynamically allocated when package-specific users get installed."
	else
		#TODO give user option to set up AutoUid for passwd if fink.conf
		#doesn't have it
		echo "We recommend allocating UIDs and GIDs automatically, unless you have"
		echo "specific requirements for UIDs and GIDs."
		/bin/echo "Set UIDs/GIDs automatically? [Y/n] \c"
		read answer
		answer=`echo $answer | sed 's/^[yY].*$/y/'`
		if [ -z "$answer" -o "x$answer" = "xy" ]; then
			printf "AutoUid: true\n" >> passwd.conf
			printf "AutoUidMin: %d\n" `%p/share/%n/get_fink_auto_uid.pl --min` >> passwd.conf
			printf "AutoUidMax: %d\n" `%p/share/%n/get_fink_auto_uid.pl --max` >> passwd.conf			
			echo "UIDs and GIDs will be dynamically allocated when package-specific users get installed."
		else
			echo "OK.  You will be prompted to enter ID numbers for each package-specific user."
			printf "AutoUid: false\n" >> passwd.conf	
		fi
	fi
fi
<< 
SplitOff: <<
 Package: passwd-news
 Description: User and group entries for the news server
 Depends: passwd-core (>= 20121118-1)
 DocFiles: README
 PostInstScript: <<
  %p/sbin/update-passwd news 'News Server' /dev/null /dev/null news news
 <<
<<
SplitOff2: <<
 Package: passwd-postgres
 Description: User and group entries for the PostgreSQL database server
 Depends: passwd-core (>= 20121118-1)
 DocFiles: README
 PostInstScript: <<
  %p/sbin/update-passwd postinst %n
 <<
<<
SplitOff3: <<
 Package: passwd-games
 Description: User and group entries for the games-files owner
 Depends: passwd-core (>= 20121118-1)
 DocFiles: README
 PostInstScript: <<
  %p/sbin/update-passwd postinst %n
 <<
<<
SplitOff4: <<
 Package: passwd-canna
 Description: User and group entries for the Canna Japanese input server
 Depends: passwd-core (>= 20121118-1)
 DocFiles: README
 PostInstScript: <<
  %p/sbin/update-passwd postinst %n
 <<
<<
SplitOff5: <<
 Package: passwd-maildrop
 Description: User and group entries for the maildrop mail delivery agent
 Depends: passwd-core (>= 20121118-1)
 DocFiles: README
 PostInstScript: <<
  %p/sbin/update-passwd postinst %n
 <<
<<
SplitOff6: <<
 Package: passwd-tomcat
 Description: User and group entries for the Tomcat servlet engine
 Depends: passwd-core (>= 20121118-1)
 DocFiles: README
 PostInstScript: <<
  %p/sbin/update-passwd postinst %n
 <<
<<
SplitOff7: <<
 Package: passwd-opennms
 Description: User and group entries for OpenNMS network management
 Depends: passwd-core (>= 20121118-1)
 DocFiles: README
 PostInstScript: <<
  %p/sbin/update-passwd postinst %n
 <<
<<
SplitOff8: <<
 Package: passwd-distcc
 Description: User and group entries for the distcc daemon
 Depends: passwd-core (>= 20121118-1)
 DocFiles: README
 PostInstScript: <<
  %p/sbin/update-passwd postinst %n
 <<
<<
SplitOff9: <<
 Package: passwd-messagebus
 Description: User and group entries for the dbus daemon
 Depends: passwd-core (>= 20121118-1)
 DocFiles: README
 PostInstScript: <<
  %p/sbin/update-passwd postinst %n
 <<
<<
SplitOff10: <<
 Package: passwd-icecast
 Description: User and group entries for the Icecast server
 Depends: passwd-core (>= 20121118-1)
 DocFiles: README
 PostInstScript: <<
  %p/sbin/update-passwd postinst %n
 <<
<<
SplitOff11: <<
 Package: passwd-gdm
 Description: User and group entries for the gdm login GUI
 Depends: passwd-core (>= 20121118-1)
 DocFiles: README
 PostInstScript: <<
  %p/sbin/update-passwd postinst %n
 <<
<<
SplitOff12: <<
 Package: passwd-fink-bld
 Description: OBSOLETE User and group entries for the fink build system
 RuntimeDepends: fink (>=0.33.0), fink-obsolete-packages
 DocFiles: README
<<
SplitOff13: <<
 Package: passwd-ossec
 Description: User and group entries for the OSSec HIDS monitor daemon
 Depends: passwd-core (>= 20121118-1)
 DocFiles: README
 PostInstScript: <<
  %p/sbin/update-passwd postinst %n
 <<
<<
SplitOff14: <<
 Package: passwd-rt
 Description: User and group entries for Request Tracker
 Depends: passwd-core (>= 20121118-1)
 DocFiles: README
 PostInstScript: <<
  %p/sbin/update-passwd postinst %n
 <<
<<
SplitOff15: <<
 Package: passwd-dovecot
 Description: OBSOLETE entries for the Dovecot IMAP server daemon
 RuntimeDepends: fink (>=0.33.0), fink-obsolete-packages
 DocFiles: README
<<
SplitOff16: <<
 Package: passwd-haldaemon
 Description: User and group entries for the Hardware Abstraction Layer
 Depends: passwd-core (>= 20121118-1)
 Conflicts: passwd-haldeamon
 Replaces: passwd-haldeamon
 DocFiles: README
 PostInstScript: <<
  %p/sbin/update-passwd postinst %n
 <<
<<
SplitOff17: <<
 Package: passwd-avahi
 Description: User and group entries for the service-discovery daemon
 Depends: passwd-core (>= 20121118-1)
 DocFiles: README
 PostInstScript: <<
  %p/sbin/update-passwd postinst %n
 <<
<<
SplitOff18: <<
 Package: passwd-nagios
 Description: User and group entries for the Nagios/Icinga monitors
 Depends: passwd-core (>= 20121118-1)
 DocFiles: README
 PostInstScript: <<
  %p/sbin/update-passwd postinst %n
 <<
<<
SplitOff19: <<
 Package: passwd-amqp
 Description: User and group entries for the AMQP messaging daemon
 Depends: passwd-core (>= 20121118-1)
 DocFiles: README
 PostInstScript: <<
  %p/sbin/update-passwd postinst %n
 <<
<<
## More users can be added here as additional SplitOffN fields
## If a user becomes obsolete, that SplitOffN can be commented out
## as well as the corresponding entries in %p/etc/{passwd-fink,group-fink}

DocFiles: README
#
Description: User and group entries for daemons: core pkg
DescDetail: <<
This package adds several administrative user and group entries to
your user database. These are needed to protect the data of several
daemons (e.g. news server, database server).
<<
DescUsage: <<
Packages that require a specific user (@user@), should set Depends: on 
'passwd-@user@'.  Packages that currently depend on 'passwd' (the legacy 
non-split package) can be upgraded at will to use their needed passwd-@user@
package.

As of version 20121118, the data required for each user has been migrated into
its own package, rather than relying on a central database from passwd-core.  
The format is:

username 'Real Name' home shell groupname 'Group membership string'

<<
DescPackaging: <<
Each user:group is now controlled by a splitoff. Packages that require a specific
user should depend on 'passwd-@user@' and not on the base package 'passwd'.
<<
License: Public Domain
Maintainer: Fink Core Group <fink-core@lists.sourceforge.net>
